# Wellbehaved

Обертка вокруг питоновского проекта ```behave``` (который, в свою очередь, является портом ```Cucumber``` из Ruby), добавляющая возможность написания плагинов и шаблонизацию с использованием Jinja2.

## Использование

* Установите пакет ```wellbehaved``` со стандартного PyPi-сервера "БАРС Груп":
```
pip install wellbehaved -i https://<PyPi_сервер_БАРС_Груп>/simple
```

* Добавьте его в ```INSTALLED_APPS``` проекта:
```
INSTALLED_APPS += ('wellbehaved',)
```
 * Расположите файлы с описанием поведения (_<имя фичи>.feature_) одним из следующих способов:
    * одна из списка папок, указанного в настройке ```WELLBEHAVED_SEARCH_DIRECTORIES```;
    * в одной из подпапок корня проекта (настройка ```PROJECT_ROOT```)
 * Запустить тестирование можно с помощью обычной команды:
```
./wellbehaved --cfg-file cfg.yaml --var-file vars.py -- --lang ru
```

## Настройки

Для удобства передачи опций ```behave```, используется следующая схема:

```
wellbehaved [--cfg-file <файл конфигурации>] [--var-file <файл с переменными>] -- [опции behave]
```

- --cfg-file *имя файла*
 YAML-файл с настройками плагинов:
 - **plugins** - словарь с настройками, ключами которого являются идентификаторы отдельных плагинов;
 - **enabled_plugins** - список идентификаторов плагинов, которые будут применяться при прогоне тестов.

- --var-file *имя файла*
Python-файл с переменными для шаблонизатора. Весь словарь переменных и функций, полученный в ходе исполнения
этого файла будет передан в качестве контекста Jinja2, после чего будет использоваться для подстановки переменных в каждом feature-файле.

## Плагины

* **redmine**
    Позволяет пропускать выполнение определенных сценариев при соответствии статуса связанной задачи в Redmine одному из заданных.

    Настройки:
    * _host_ - адрес сервера Redmine;
    * _user_ - имя пользователя;
    * _pass_ - пароль;
    * _statuses_ - разделенный запятыми список наименований статусов задач.

    Сценарий связывается с задачей через тэг формы **@redmoine{{taskID}}**:
    ```
    @tag1 @redmine12345
    Scenario: hello, world!
    ```

## Пример использованиия

Предположим, что пока задача _12345_ находится в статусах _"Разработка"_ и _"Анализ"_ нам нет смысла прогонять сценарий тестирования личной страницы. Так как имя пользователя используется во многих тестовых файлах одновременно и со временем может изменится, было решено сделать его переменным.

Файл с переменными:
```
#coding: utf-8

username = u'Тестовый Пользователь'
```

Файл конфигурации:
```
plugins:
  redmine:
    host: http://task.bars-open.ru
    user: user1
    pass: pass1
    statuses: ['Разработка', 'Анализ']
```

Feature-файл:
```
Функция: работа с рабочим столом
    @redmine12345
    Сценарий: открытие личной страницы
        Дано пользователь "{{username}}"
        И пользователь вошел в систему
        Когда в меню выбрана "Личная страница"
        То открывается страница с иконками
```

Запуск:
```
./wellbehaved --cfg-file cfg.yaml --var-file vars.py -- --lang py
```

## Контакты

С вопросами по доработкам, применению и с сообщениями об ошибках пишите на <borisov@bars-open.ru>

## Благодарности

* Юле Касимовой (<kasimova@bars-open.ru>) - самоотверженное участие в тестировании продукта;
* Сергею Чипиге (<svchipiga@bars-open.ru>) - нахождение багов;
* Вадиму Малышеву (<vvmalyshev@bars-open.ru>) - продавливании идеи изучения концепций BDD.


## Ссылки

- [Writing Features - Gherkin Language][Writing Features]
- [Behavior Driven Development (from behave documentation)][Behavior Driven Development]
- [List of behave formatters][behave Formatters]

[Writing Features]: http://docs.behat.org/guides/1.gherkin.html
[Behavior Driven Development]: http://pythonhosted.org/behave/philosophy.html
[behave Formatters]: http://pythonhosted.org/behave/formatters.html
